<div id="text_content" contenteditable onkeyup="saveBuffer()"></div>
<input type="text" id="file_name" value="file-name.txt">
<button id="save_button" onclick="saveFile()">Save File</button>
<input id="file_loader" type="file" onchange="loadFile()" placeholder="Load File" accept=".js, .txt, .md, .css">
<button id="clear_buffer" onclick="clearBuffer()">Clear Buffer</button>
<button id="run_file" onclick="runFile()">Run File</button>

<script>
  function saveFile(){
    var blob = new Blob([text_content.innerText], { type: 'text/plain' });
    const downloadLink = document.createElement('a');
    downloadLink.href = window.URL.createObjectURL(blob);
    downloadLink.download = file_name.value;
    document.body.appendChild(downloadLink);
    downloadLink.click();
    document.body.removeChild(downloadLink);
  }

  function loadFile(){
    const reader = new FileReader();
    reader.addEventListener('load', function() {
      text_content.innerText = reader.result
    });
    const selected_file = file_loader.files[0];
    reader.readAsText(selected_file)
  }

  function saveBuffer(){
    localStorage.setItem('buffer-content', text_content.innerHTML)
  }

  function loadBuffer(){
    const buffer_content = localStorage.getItem('buffer-content')
    if(buffer_content !== 'null'){
      text_content.innerHTML = buffer_content
    }
  }

  function runFile(){
    const code = text_content.innerText
    try {
      eval(code)
    } catch(e){
      console.error(e.message)
    }
  }

  function clearBuffer(){
    text_content.innerText = ''
  }

  document.addEventListener("DOMContentLoaded", (event) => {
    loadBuffer()
  })

  document.addEventListener('keydown', (e) => {
    if(!e.ctrlKey) return
    if(e.key === 'o') file_loader.click()
    if(e.key === 's') saveFile()
    if(e.key === 'r') runFile()
    if(e.key === 'Escape') clearBuffer()
  })
</script>

<style>

  #text_content {
    font-family: monospace;
    border: 1px dashed lightgrey;
    padding: 1em;
    height: calc(100% - 4em);
    overflow: scroll;
    margin-bottom: 0.5em;
  }
</style>